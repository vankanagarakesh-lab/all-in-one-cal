<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Master STEM 3D Visualizer</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        :root { --bg: #0b0e14; --card: #161b22; --text: #e6edf3; --accent: #3b82f6; --math: #fbbf24; }
        body.light-mode { --bg: #f8f9fa; --card: #ffffff; --text: #1f2937; --accent: #2563eb; --math: #d97706; }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; }
        .wrapper { max-width: 1200px; margin: auto; padding: 20px; text-align: center; }
        .glass-panel { background: var(--card); padding: 25px; border-radius: 16px; border: 1px solid rgba(128,128,128,0.2); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-t { background: #6366f1; } .btn-r { background: #f59e0b; } .btn-a { background: #ef4444; } 
        .anim-on { background: #10b981 !important; box-shadow: 0 0 15px #10b981; }

        select, input { padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: var(--bg); color: var(--text); margin: 5px; width: 95%; max-width: 380px; font-size: 15px; }
        .formula-display { background: rgba(0,0,0,0.15); padding: 15px; border-radius: 10px; border-left: 5px solid var(--accent); margin: 20px 0; font-family: monospace; color: var(--math); font-size: 14px; text-align: left; min-height: 40px; }
        
        #plot { width: 100%; height: 600px; border-radius: 12px; margin-top: 20px; }
        .grid-params { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .p-box { display: flex; flex-direction: column; font-size: 11px; font-weight: bold; color: var(--accent); text-transform: uppercase; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="nav">
        <button class="btn-t" onclick="toggleTheme()">üåì Theme</button>
        <button class="btn-r" onclick="toggleRotate()">üîÑ Auto-Rotate</button>
        <button class="btn-a" id="animBtn" onclick="toggleAnimation()">‚ñ∂ Start Motion</button>
    </div>

    <div class="glass-panel">
        <h2 style="margin:0 0 10px 0;">üìê Comprehensive 3D Math Engine</h2>
        
        <select id="graphSelector" onchange="updateUI()">
            <optgroup label="1. PLANES">
                <option value="hPlane">Horizontal Plane (z=c)</option>
                <option value="vPlane">Vertical Plane (x=c)</option>
                <option value="incPlane">Inclined Plane (z=ax+by)</option>
                <option value="genPlane">General Plane (Ax+By+Cz+D=0)</option>
            </optgroup>
            <optgroup label="2. CYLINDERS">
                <option value="circCyl">Circular Cylinder</option>
                <option value="ellipCyl">Elliptic Cylinder</option>
                <option value="paraCyl">Parabolic Cylinder</option>
                <option value="hyperCyl">Hyperbolic Cylinder</option>
            </optgroup>
            <optgroup label="3. CONES">
                <option value="cone">Right Circular Cone</option>
                <option value="doubleCone">Double Cone</option>
                <option value="ellipCone">Elliptic Cone</option>
            </optgroup>
            <optgroup label="4. SPHERES & ELLIPSOIDS">
                <option value="sphere">Sphere</option>
                <option value="ellipsoid">Ellipsoid / Spheroid</option>
            </optgroup>
            <optgroup label="5. PARABOLOIDS">
                <option value="ellipPara">Elliptic Paraboloid</option>
                <option value="hyperPara">Hyperbolic Paraboloid (Saddle)</option>
                <option value="paraSurf">Parabolic Surface</option>
            </optgroup>
            <optgroup label="6. HYPERBOLOIDS">
                <option value="hyper1">Hyperboloid (One Sheet)</option>
                <option value="hyper2">Hyperboloid (Two Sheets)</option>
            </optgroup>
            <optgroup label="7. TRIG & EXPONENTIAL">
                <option value="sine">Sine Surface</option>
                <option value="wave">Wave Surface [sin(x)+cos(y)]</option>
                <option value="ripple">Ripple Surface</option>
                <option value="expSurf">Exponential Surface</option>
                <option value="logSurf">Logarithmic Surface</option>
            </optgroup>
            <optgroup label="8. PARAMETRIC">
                <option value="torus">Torus (Donut)</option>
                <option value="helix">Helix Curve</option>
                <option value="spiral">Spiral Curve</option>
            </optgroup>
        </select>

        <div class="formula-display" id="mathFormula">Logic: Loading...</div>

        <div class="grid-params">
            <div class="p-box"><input type="number" id="v1" value="2" step="0.1"><label id="l1">Val A</label></div>
            <div class="p-box"><input type="number" id="v2" value="1" step="0.1"><label id="l2">Val B</label></div>
            <div class="p-box"><input type="number" id="v3" value="0.5" step="0.1"><label id="l3">Speed</label></div>
        </div>
        <button onclick="draw()" style="background:var(--accent); width:200px; margin-top:15px;">Draw Static</button>
    </div>

    <div id="plot" class="glass-panel"></div>
</div>

<script>
let isLight = false, rot = null, anim = null, t = 0, angle = 0;

function toggleTheme() {
    isLight = !isLight;
    document.body.classList.toggle('light-mode');
    draw();
}

function toggleRotate() {
    if(rot) { clearInterval(rot); rot = null; }
    else {
        rot = setInterval(() => {
            angle += 0.02;
            Plotly.relayout('plot', { 'scene.camera.eye': { x: 1.8*Math.cos(angle), y: 1.8*Math.sin(angle), z: 1 } });
        }, 40);
    }
}

function toggleAnimation() {
    const btn = document.getElementById("animBtn");
    if(anim) { clearInterval(anim); anim = null; btn.innerText = "‚ñ∂ Start Motion"; btn.classList.remove("anim-on"); }
    else {
        btn.innerText = "‚ñ† Stop Motion"; btn.classList.add("anim-on");
        anim = setInterval(() => { t += 0.1; draw(true); }, 50);
    }
}

function updateUI() {
    const sel = graphSelector.value;
    const f = document.getElementById("mathFormula");
    const maps = {
        hPlane: ["z = c + sin(t)", "Height (c)", "unused", "Pulse"],
        incPlane: ["z = ax + by + sin(t)", "Slope X (a)", "Slope Y (b)", "Speed"],
        circCyl: ["x¬≤ + y¬≤ = r¬≤", "Radius (r)", "Height", "Spin"],
        ellipPara: ["z = x¬≤/a¬≤ + y¬≤/b¬≤ + sin(t)", "A Stretch", "B Stretch", "Bounce"],
        hyperPara: ["z = x¬≤ - y¬≤ + cos(t)", "A Stretch", "B Stretch", "Speed"],
        sphere: ["x¬≤ + y¬≤ + z¬≤ = r¬≤", "Radius (r)", "unused", "Pulse"],
        torus: ["Parametric Donut Logic", "Ring Radius", "Tube Radius", "Rotation"],
        ripple: ["z = sin(‚àö(x¬≤+y¬≤)-t)", "Freq", "Damping", "Wave Speed"]
    };
    const c = maps[sel] || ["z = f(x, y, t)", "Param A", "Param B", "Speed"];
    f.innerHTML = "<strong>Logic Formula:</strong> " + c[0];
    l1.innerText = c[1]; l2.innerText = c[2]; l3.innerText = c[3];
}

function draw(isUpdate = false) {
    const type = graphSelector.value;
    const a = parseFloat(v1.value) || 1;
    const b = parseFloat(v2.value) || 1;
    const s = parseFloat(v3.value) || 0.5;
    const tv = t * s;

    // Parametric Handling
    if(["torus", "helix", "spiral"].includes(type)) {
        let uRange = []; for(let i=0; i<=6.4; i+=0.2) uRange.push(i);
        if(type === "torus") {
            let X=[], Y=[], Z=[];
            for(let u of uRange) {
                let xr=[], yr=[], zr=[];
                for(let v of uRange) {
                    xr.push((a + b * Math.cos(v)) * Math.cos(u + tv));
                    yr.push((a + b * Math.cos(v)) * Math.sin(u + tv));
                    zr.push(b * Math.sin(v));
                }
                X.push(xr); Y.push(yr); Z.push(zr);
            }
            render(X, Y, Z, isUpdate, 'surface');
        } else {
            let pts = []; for(let i=0; i<12; i+=0.1) pts.push(i);
            let X = pts.map(p => type==="helix" ? a*Math.cos(p+tv) : p*Math.cos(p+tv));
            let Y = pts.map(p => type==="helix" ? a*Math.sin(p+tv) : p*Math.sin(p+tv));
            let Z = pts.map(p => b*p);
            render(X, Y, Z, isUpdate, 'scatter3d');
        }
        return;
    }

    // Grid Handling
    let x = [], y = [];
    for(let i=-5; i<=5; i+=0.4) { x.push(i); y.push(i); }
    let z = y.map(Y => x.map(X => {
        let r = Math.sqrt(X*X + Y*Y) + 0.1;
        switch(type) {
            case "hPlane": return a + Math.sin(tv);
            case "vPlane": return X > a ? 5 : -5;
            case "incPlane": return a*X + b*Y + Math.sin(tv);
            case "genPlane": return (-a*X - b*Y - 2)/1 + Math.sin(tv);
            case "circCyl": return Math.abs(r - a) < 0.5 ? 5 : null;
            case "ellipCyl": return (X*X)/(a*a) + (Y*Y)/(b*b) < 1 ? Y : null;
            case "paraCyl": return X*X * 0.2;
            case "hyperCyl": return X*X - Y*Y;
            case "cone": return Math.sqrt(X*X + Y*Y) * a;
            case "doubleCone": return Math.sqrt(X*X + Y*Y) * Math.sin(tv);
            case "sphere": return r < a ? Math.sqrt(a*a - r*r) : null;
            case "ellipsoid": let v = 1 - (X*X)/(a*a) - (Y*Y)/(b*b); return v > 0 ? b*Math.sqrt(v) : null;
            case "ellipPara": return (X*X + Y*Y) / a + Math.sin(tv);
            case "hyperPara": return (X*X - Y*Y) / a;
            case "paraSurf": return X*X;
            case "hyper1": return Math.sqrt(X*X + Y*Y + 1) * Math.sin(tv);
            case "hyper2": return Math.sqrt(X*X + Y*Y - 1);
            case "sine": return a * Math.sin(X + tv);
            case "wave": return Math.sin(X + tv) + Math.cos(Y + tv);
            case "ripple": return a * Math.sin(b * r - tv);
            case "expSurf": return Math.exp((X+Y)/5) * Math.sin(tv);
            case "logSurf": return Math.log(r + 1) * a;
            default: return 0;
        }
    }));
    render(x, y, z, isUpdate, 'surface');
}

function render(x, y, z, isUpdate, mode) {
    const trace = mode === 'surface' 
        ? { x:x, y:y, z:z, type:'surface', colorscale:'Viridis', showscale:false }
        : { x:x, y:y, z:z, type:'scatter3d', mode:'lines', line:{width:6, color: isLight?'blue':'yellow'}};
    
    const layout = {
        paper_bgcolor: "rgba(0,0,0,0)", plot_bgcolor: "rgba(0,0,0,0)",
        margin: {l:0,r:0,t:0,b:0}, font: { color: isLight ? "#1f2937" : "#e6edf3" },
        scene: { xaxis:{range:[-5,5]}, yaxis:{range:[-5,5]}, zaxis:{range:[-5,5]} }
    };

    if(isUpdate) Plotly.react("plot", [trace], layout);
    else Plotly.newPlot("plot", [trace], layout);
}

window.onload = () => { updateUI(); draw(); };
</script>
</body>
</html>