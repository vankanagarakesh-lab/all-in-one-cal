<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Universal Animated Geometry</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #58a6ff; --text: #c9d1d9; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #graph { width: 100%; height: 50vh; background: #000; }
        .controls { flex: 1; padding: 15px; overflow-y: auto; background: var(--card); border-top: 1px solid #30363d; }
        .input-box { display: flex; flex-direction: column; gap: 5px; margin-bottom: 12px; }
        label { font-size: 11px; font-weight: bold; color: #8b949e; text-transform: uppercase; }
        input, select { background: #0d1117; border: 1px solid #30363d; color: #79c0ff; padding: 10px; border-radius: 6px; font-family: monospace; }
        .formula-bar { border: 1px solid var(--accent); font-size: 14px; }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; }
        .btn-plot { background: var(--accent); }
        .btn-anim { background: #238636; }
        .anim-active { background: #da3633 !important; }
        .hint { font-size: 10px; color: #58a6ff; margin-top: 3px; }
    </style>
</head>
<body>

<div id="graph"></div>

<div class="controls">
    <div class="input-box">
        <label>1. Select Geometry (All Animated)</label>
        <select id="graphSelector" onchange="applyPreset()">
            <optgroup label="1. PLANES">
                <option value="2 * Math.sin(t)">Horizontal Plane (z=c*sin t)</option>
                <option value="Math.abs(x - 2 * Math.sin(t)) < 0.2 ? 5 : -5">Vertical Plane (x=c*sin t)</option>
                <option value="0.5*x + 0.8*y + 2*Math.sin(t)">Inclined Plane (Sliding)</option>
                <option value="-(x*Math.cos(t) + y*Math.sin(t))">General Plane (Rotating)</option>
            </optgroup>
            <optgroup label="2. CYLINDERS">
                <option value="Math.abs(Math.sqrt(x*x+y*y) - (2 + Math.sin(t))) < 0.2 ? 5 : -5">Circular Cylinder (Pulsing)</option>
                <option value="Math.abs((x*x/(4+Math.sin(t))) + (y*y/9) - 1) < 0.1 ? 5 : -5">Elliptic Cylinder (Morphing)</option>
                <option value="Math.abs(y - (0.5 + 0.2*Math.sin(t))*x*x) < 0.2 ? 5 : -5">Parabolic Cylinder (Flexing)</option>
                <option value="Math.abs(x*x - y*y - (2 + Math.sin(t))) < 0.2 ? 5 : -5">Hyperbolic Cylinder (Shifting)</option>
            </optgroup>
            <optgroup label="3. CONES">
                <option value="(1.5 + 0.5*Math.sin(t)) * Math.sqrt(x*x + y*y) - 4">Right Circular Cone</option>
                <option value="Math.abs((1.5 + 0.5*Math.sin(t)) * Math.sqrt(x*x + y*y)) - 3">Double Cone</option>
                <option value="Math.sqrt(x*x/(2+Math.sin(t)) + y*y/4) * 2 - 4">Elliptic Cone</option>
            </optgroup>
            <optgroup label="4. SPHERES & ELLIPSOIDS">
                <option value="Math.sqrt(Math.max(0, Math.pow(2.5 + Math.sin(t), 2) - (x*x + y*y)))">Sphere (Breathing)</option>
                <option value="Math.sqrt(Math.max(0, 1 - (x*x/(10+5*Math.sin(t)) + y*y/9))) * 3">Ellipsoid (Squashing)</option>
            </optgroup>
            <optgroup label="5. PARABOLOIDS">
                <option value="(x*x/3 + y*y/3) - 4 + 2*Math.sin(t)">Elliptic Paraboloid</option>
                <option value="(x*x/(4+Math.sin(t)) - y*y/4)">Hyperbolic Paraboloid</option>
                <option value="(0.5 + 0.2*Math.sin(t))*x*x - 4">Parabolic Surface</option>
            </optgroup>
            <optgroup label="6. HYPERBOLOIDS">
                <option value="Math.sqrt(x*x + y*y + 2 + Math.sin(t)) - 3">Hyperboloid (One Sheet)</option>
                <option value="x*x + y*y < (2+Math.sin(t)) ? Math.sqrt((2+Math.sin(t)) - (x*x + y*y)) : null">Hyperboloid (Two Sheets)</option>
            </optgroup>
            <optgroup label="7. TRIG & EXPONENTIAL">
                <option value="2 * Math.sin(x + t)">Sine Surface</option>
                <option value="Math.sin(x + t) + Math.cos(y + t)">Wave Surface</option>
                <option value="2 * Math.sin(Math.sqrt(x*x+y*y) - t)">Ripple Surface</option>
                <option value="Math.exp(x/3) * Math.cos(t)">Exponential Surface</option>
                <option value="Math.log(Math.sqrt(x*x+y*y) + 1) + 2*Math.sin(t)">Logarithmic Surface</option>
            </optgroup>
            <optgroup label="8. PARAMETRIC (Z-Based)">
                <option value="Math.sin(Math.atan2(y,x)*3 + t)">Torus-Like Wave</option>
                <option value="Math.cos(x + t) * Math.sin(y + t)">Dancing Grid</option>
            </optgroup>
        </select>
    </div>

    <div class="input-box">
        <label>2. Formula Editor (Edit 't' to change animation)</label>
        <input type="text" id="formulaInput" class="formula-bar" value="2 * Math.sin(Math.sqrt(x*x+y*y) - t)">
        <div class="hint">Variable 't' is controlled by the speed slider.</div>
    </div>

    <div class="input-box">
        <label>3. Speed Multiplier</label>
        <input type="range" id="speed" min="0" max="5" step="0.1" value="1.5">
        <div class="btn-row">
            <button class="btn-plot" onclick="draw()">Manual Plot</button>
            <button id="animBtn" class="btn-anim" onclick="toggleAnimation()">▶ Start Animation</button>
        </div>
    </div>
</div>

<script>
let t = 0, animInterval = null;

function applyPreset() {
    document.getElementById("formulaInput").value = document.getElementById("graphSelector").value;
    draw();
}

function toggleAnimation() {
    const btn = document.getElementById("animBtn");
    if(animInterval) {
        clearInterval(animInterval); animInterval = null;
        btn.innerText = "▶ Start Animation"; btn.classList.remove("anim-active");
    } else {
        btn.innerText = "■ Stop Animation"; btn.classList.add("anim-active");
        animInterval = setInterval(() => {
            t += 0.05 * parseFloat(document.getElementById("speed").value);
            draw(true);
        }, 30);
    }
}

function draw(isUpdate = false) {
    const fStr = document.getElementById("formulaInput").value;
    const range = [];
    for(let i = -5; i <= 5; i += 0.4) range.push(i);

    let zData = [];
    try {
        const formula = new Function('x', 'y', 't', `return ${fStr};`);
        zData = range.map(y => range.map(x => {
            const val = formula(x, y, t);
            return (typeof val === 'number' && isFinite(val)) ? val : null;
        }));
    } catch(e) { return; }

    const data = [{
        x: range, y: range, z: zData,
        type: 'surface', colorscale: 'Portland', showscale: false,
        lighting: { ambient: 0.6, diffuse: 0.8, specular: 0.5 }
    }];

    const layout = {
        margin: {l:0, r:0, t:0, b:0},
        paper_bgcolor: '#0d1117',
        scene: {
            xaxis: { gridcolor: '#333', range: [-5, 5], backgroundcolor: "#0d1117", showbackground: true },
            yaxis: { gridcolor: '#333', range: [-5, 5], backgroundcolor: "#0d1117", showbackground: true },
            zaxis: { gridcolor: '#333', range: [-5, 5], backgroundcolor: "#0d1117", showbackground: true }
        },
        uirevision: 'true'
    };

    if(isUpdate) Plotly.react('graph', data, layout);
    else Plotly.newPlot('graph', data, layout);
}

window.onload = () => { applyPreset(); };
</script>
</body>
</html>