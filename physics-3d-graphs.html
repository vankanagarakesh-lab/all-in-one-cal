<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Physics Master Suite - Fully Interactive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        :root {
            --bg: #0b0e14;
            --card: #161b22;
            --input-bg: #1e222b;
            --text: #e6edf3;
            --accent: #2f80ed;
            --math: #fbbf24;
        }

        body {
            margin: 0;
            background: var(--bg);
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            font-family: system-ui, -apple-system, Arial, sans-serif;
            color: var(--text);
            overflow: hidden;
        }

        .app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header { 
            padding: 12px; 
            text-align: center; 
            background: var(--card);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        #graph {
            width: 100%;
            height: 60vh; /* Slightly larger for better interaction */
            background: #000;
            flex-shrink: 0;
        }

        .ui-wrapper {
            max-width: 1000px;
            width: 95%;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 40px;
        }

        .formula-box {
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid var(--accent);
            font-family: monospace;
            font-size: 14px;
            color: var(--math);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        @media (min-width: 768px) {
            .controls-grid { grid-template-columns: 1fr 1fr 1fr; }
            .full-row { grid-column: span 3; }
        }

        select, input {
            width: 100%;
            padding: 14px;
            box-sizing: border-box;
            font-size: 16px;
            border-radius: 10px;
            border: 1px solid rgba(128,128,128,0.2);
            background: var(--card);
            color: white;
            outline: none;
        }

        .label-text {
            font-size: 11px;
            text-transform: uppercase;
            color: #8b949e;
            margin-bottom: 5px;
            display: block;
        }

        .btn-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        button {
            padding: 16px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            color: white;
            background: var(--accent);
            transition: 0.2s;
        }

        .btn-sec { background: #30363d; }
        .btn-anim { background: #238636; }
        .anim-active { background: #da3633 !important; }
        button:hover { filter: brightness(1.1); }
        button:active { transform: scale(0.98); }

    </style>
</head>
<body>

<div class="app-container">
    <div class="header"><h2>ðŸ”¬ 3D Physics Master Suite</h2></div>

    <div class="content">
        <div id="graph"></div>

        <div class="ui-wrapper">
            <div class="formula-box" id="formula">Select a phenomenon to begin...</div>

            <div class="controls-grid">
                <div class="full-row">
                    <span class="label-text">Physical Model</span>
                    <select id="masterType" onchange="updateUI()">
                        <optgroup label="1. MECHANICS">
                            <option value="posTime">Positionâ€“Timeâ€“Space (x,y,t)</option>
                            <option value="velField">Velocity Field Surface</option>
                            <option value="accel">Acceleration Field Surface</option>
                            <option value="proj">Projectile Motion Surface</option>
                            <option value="potE">Potential Energy Surface</option>
                            <option value="kinE">Kinetic Energy Dist.</option>
                            <option value="grav">Gravitational Field (Warp)</option>
                            <option value="equiGrav">Equipotential (Gravity)</option>
                        </optgroup>
                        <optgroup label="2. WAVES & OSCILLATIONS">
                            <option value="travel">Travelling Wave [A sin(kx-wt)]</option>
                            <option value="stand">Standing Wave Surface</option>
                            <option value="sound">Sound Wave Intensity</option>
                            <option value="ripple">Ripple Tank Wave</option>
                            <option value="super">Wave Superposition</option>
                        </optgroup>
                        <optgroup label="3. ELECTRICITY & MAGNETISM">
                            <option value="ePot">Electric Potential Surface</option>
                            <option value="equiE">Equipotential (Electric)</option>
                            <option value="dipole">Field around Electric Dipole</option>
                            <option value="wire">Current-Carrying Wire Field</option>
                            <option value="solenoid">Solenoid Magnetic Field</option>
                            <option value="emWave">Electromagnetic Wave (E/B)</option>
                        </optgroup>
                        <optgroup label="4. THERMODYNAMICS">
                            <option value="pvt">PVâ€“T Surface (Ideal Gas)</option>
                            <option value="iso">Isothermal Surface</option>
                            <option value="adia">Adiabatic Surface</option>
                            <option value="entropy">Entropy Surface</option>
                        </optgroup>
                        <optgroup label="5. OPTICS">
                            <option value="diff">Diffraction Pattern (Sinc)</option>
                            <option value="interf">Interference Fringe Surface</option>
                            <option value="wavef">Wavefront Surface</option>
                        </optgroup>
                        <optgroup label="6. MODERN / QUANTUM">
                            <option value="psi">Wave Function Surface (Ïˆ)</option>
                            <option value="psiSq">Probability Density (|Ïˆ|Â²)</option>
                            <option value="well">Potential Well (Infinite)</option>
                            <option value="band">Band Structure Surface</option>
                        </optgroup>
                        <optgroup label="7. FLUIDS">
                            <option value="fPres">Pressure Distribution (Bernoulli)</option>
                            <option value="stream">Streamline Surface</option>
                            <option value="turb">Turbulence Intensity</option>
                        </optgroup>
                    </select>
                </div>

                <div>
                    <span class="label-text" id="l1">Param A</span>
                    <input type="number" id="v1" value="2" step="0.1">
                </div>
                <div>
                    <span class="label-text" id="l2">Param B</span>
                    <input type="number" id="v2" value="1" step="0.1">
                </div>
                <div>
                    <span class="label-text" id="l3">Animation Speed</span>
                    <input type="number" id="v3" value="0.5" step="0.1">
                </div>
            </div>

            <div class="btn-row">
                <button class="btn-sec" onclick="toggleRotate()">ðŸ”„ Auto-Rotate</button>
                <button id="animBtn" class="btn-anim" onclick="toggleAnimation()">â–¶ Start Animation</button>
                <button onclick="draw()">Update Plot</button>
            </div>
            <p style="font-size: 12px; color: #8b949e; text-align: center;">ðŸ’¡ Use your mouse/touch to zoom, pan, and rotate 360Â° during animation.</p>
        </div>
    </div>
</div>

<script>
let rot = null, anim = null, t = 0, angle = 0;
let userCamera = null; // Stores your zoom/rotation

// Capture camera changes made by the user
function updateCameraStorage() {
    const gd = document.getElementById('graph');
    if (gd._fullLayout && gd._fullLayout.scene) {
        userCamera = gd._fullLayout.scene.camera;
    }
}

function toggleRotate() {
    if(rot) { clearInterval(rot); rot = null; }
    else {
        rot = setInterval(() => {
            angle += 0.02;
            Plotly.relayout('graph', { 'scene.camera.eye': { x: 1.8*Math.cos(angle), y: 1.8*Math.sin(angle), z: 1.2 } });
        }, 40);
    }
}

function toggleAnimation() {
    const btn = document.getElementById("animBtn");
    if(anim) { 
        clearInterval(anim); anim = null; 
        btn.innerText = "â–¶ Start Animation"; 
        btn.classList.remove("anim-active"); 
    } else {
        btn.innerText = "â–  Stop Animation"; 
        btn.classList.add("anim-active");
        anim = setInterval(() => { t += 0.1; draw(true); }, 50);
    }
}

function updateUI() {
    const type = document.getElementById("masterType").value;
    const f = document.getElementById("formula");
    const m = {
        posTime: ["Z = A*X + B*Y + sin(t)", "X-Slope", "Y-Slope", "Time Speed"],
        proj: ["Z = A*X - 0.5*B*(XÂ²/A) + cos(t)", "In. Velocity", "Gravity", "Cycle Speed"],
        travel: ["Z = A * sin(B*X - t)", "Amplitude", "Wave # (k)", "Speed"],
        pvt: ["P = nRT / V", "n*R", "Temp Shift", "Speed"],
        psiSq: ["Z = |sin(A*X)sin(B*Y)|Â²", "n-state", "m-state", "Speed"],
        turb: ["Z = sin(A*X) + Noise", "Flow Strength", "Chaos", "Speed"]
    };
    const c = m[type] || ["Z = PhysicalLaw(X, Y, t)", "Param A", "Param B", "Speed"];
    f.innerHTML = "<strong>Physical Logic:</strong> " + c[0];
    document.getElementById("l1").innerText = c[1]; 
    document.getElementById("l2").innerText = c[2]; 
    document.getElementById("l3").innerText = c[3];
}

function draw(isUpdate = false) {
    const type = document.getElementById("masterType").value;
    const a = parseFloat(document.getElementById("v1").value) || 2;
    const b = parseFloat(document.getElementById("v2").value) || 1;
    const s = parseFloat(document.getElementById("v3").value) || 0.5;
    
    // Capture user's current zoom/rotation before redrawing
    updateCameraStorage();

    let x = [], y = [];
    for(let i=-5; i<=5; i+=0.35) { x.push(i); y.push(i); }

    let z = y.map(Y => x.map(X => {
        let r = Math.sqrt(X*X + Y*Y) + 0.1;
        let timeVar = t * s;
        switch(type) {
            case "posTime": return a*X + b*Y + Math.sin(timeVar);
            case "velField": return a * Math.exp(-r/b) * Math.cos(timeVar);
            case "accel": return a * Math.cos(timeVar);
            case "proj": return a*X - 0.5*b*(X*X/a) + Math.cos(timeVar);
            case "potE": return a*(X*X + Y*Y) * (1 + 0.2*Math.sin(timeVar));
            case "kinE": return 0.5*a*(X*X + Y*Y) * Math.abs(Math.cos(timeVar));
            case "grav": return -a / (r + 0.2*Math.sin(timeVar));
            case "equiGrav": return Math.floor(-a/r * 5 + Math.sin(timeVar));
            case "travel": return a * Math.sin(b*X - timeVar);
            case "stand": return a * Math.sin(b*X) * Math.cos(b*Y + timeVar);
            case "sound": return a / (r*r + 0.1) * (1 + 0.3*Math.sin(timeVar));
            case "ripple": return a * Math.sin(b*r - timeVar) / r;
            case "super": return a*Math.sin(X+timeVar) + b*Math.sin(Y-timeVar);
            case "ePot": return a / (r + 0.2*Math.sin(timeVar));
            case "equiE": return Math.round(a/r + Math.sin(timeVar));
            case "dipole": return (a/Math.sqrt((X-b)**2+Y**2+0.1)) - (a/Math.sqrt((X+b)**2+Y**2+0.1)) * Math.cos(timeVar);
            case "wire": return (a/r) * Math.cos(timeVar);
            case "solenoid": return a*b * (1 + 0.1*Math.sin(timeVar));
            case "emWave": return a * Math.sin(b*X - timeVar);
            case "pvt": return (a*(Y+6 + Math.sin(timeVar)))/(X+6);
            case "iso": return a / (X+6) + 0.2*Math.sin(timeVar);
            case "adia": return a / Math.pow(X+6, 1.4) + 0.2*Math.sin(timeVar);
            case "entropy": return a * Math.log(r + 1) * (1 + 0.2*Math.sin(timeVar));
            case "diff": return a * Math.pow(Math.sin(b*X + timeVar)/(b*X+0.1), 2);
            case "interf": return a * Math.pow(Math.cos(b*X + timeVar), 2);
            case "wavef": return Math.sqrt(Math.abs(a*a - r*r)) * Math.sin(timeVar);
            case "psi": return Math.sin(a*X) * Math.sin(b*Y) * Math.cos(timeVar);
            case "psiSq": return Math.pow(Math.sin(a*X)*Math.sin(b*Y), 2) * (1 + 0.5*Math.cos(timeVar));
            case "well": return r < a ? 0 : 5 + Math.sin(timeVar);
            case "band": return Math.cos(a*X + timeVar) + Math.cos(b*Y);
            case "fPres": return a - 0.5*b*r + Math.sin(timeVar);
            case "stream": return a*X*Y + 0.1*Math.sin(timeVar);
            case "turb": return a*Math.sin(X*b + timeVar) + (Math.random()*0.2);
            default: return a * Math.sin(r - timeVar);
        }
    }));

    const data = [{ x:x, y:y, z:z, type:'surface', colorscale: 'Portland', showscale: false }];
    
    const layout = {
        paper_bgcolor: "rgba(0,0,0,0)", 
        plot_bgcolor: "rgba(0,0,0,0)",
        margin: {l:0,r:0,t:0,b:0}, 
        font: { color: "#e6edf3" },
        scene: { 
            // Apply the user's camera if it exists, otherwise use default
            camera: userCamera || { eye: {x: 1.5, y: 1.5, z: 1.2} },
            xaxis: { title: 'X', gridcolor: "#333", range: [-5, 5], autorange: false }, 
            yaxis: { title: 'Y', gridcolor: "#333", range: [-5, 5], autorange: false }, 
            zaxis: { title: 'Z', gridcolor: "#333", range: [-5, 5], autorange: false } 
        },
        uirevision: 'true', // KEY: Tells Plotly not to reset UI state (zoom/rotate) on data update
    };

    if(isUpdate) Plotly.react("graph", data, layout);
    else Plotly.newPlot("graph", data, layout);
}

window.onload = () => { updateUI(); draw(); };
window.onresize = () => Plotly.Plots.resize('graph');
</script>
</body>
</html>