<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master STEM 3D Mobile</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: rgba(22, 27, 34, 0.95); --text: #e6edf3; --accent: #58a6ff; --math: #fbbf24; }
        body.light-mode { --bg: #f0f2f5; --card: rgba(255, 255, 255, 0.95); --text: #1f2937; --accent: #0969da; --math: #9a6700; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); overflow: hidden; touch-action: manipulation; }
        #plot-area { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; z-index: 1; }
        .mobile-panel {
            position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1); border-radius: 24px 24px 0 0; z-index: 10;
            padding: 12px 20px 25px; box-shadow: 0 -10px 40px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.2);
        }
        .mobile-panel.collapsed { transform: translateY(calc(100% - 60px)); }
        .handle { width: 45px; height: 5px; background: rgba(128,128,128,0.4); margin: 0 auto 12px; border-radius: 10px; cursor: pointer; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        button { padding: 10px; border-radius: 10px; border: none; font-weight: bold; font-size: 12px; cursor: pointer; color: white; transition: 0.2s; }
        .btn-theme { background: #6e7681; } .btn-rot { background: #f59e0b; } .btn-anim { background: #da3633; }
        .anim-active { background: #238636 !important; box-shadow: 0 0 10px #238636; }
        select { width: 100%; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.2); color: var(--text); border: 1px solid rgba(128,128,128,0.3); font-size: 15px; margin-bottom: 12px; }
        .logic-view { font-family: monospace; font-size: 10px; color: var(--math); background: rgba(0,0,0,0.1); padding: 8px; border-radius: 6px; margin-bottom: 12px; display: block; border-left: 3px solid var(--accent); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .controls-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .control-group { display: flex; flex-direction: column; align-items: center; }
        .control-group label { font-size: 9px; font-weight: bold; margin-bottom: 4px; color: var(--accent); text-transform: uppercase; }
        input[type="range"] { width: 100%; accent-color: var(--accent); }
    </style>
</head>
<body>

<div id="plot-area"></div>

<div class="mobile-panel" id="uiPanel">
    <div class="handle" onclick="toggleCollapse()"></div>
    
    <div class="btn-grid">
        <button class="btn-theme" onclick="toggleTheme()">ðŸŒ“ Theme</button>
        <button class="btn-rot" onclick="toggleRotate()">ðŸ”„ Rotate</button>
        <button class="btn-anim" id="animBtn" onclick="toggleAnimation()">â–¶ Play</button>
    </div>

    <select id="masterType" onchange="updateUI(); draw();">
        <optgroup label="1. MATHEMATICS (PLANES & CURVES)">
            <option value="hPlane">Horizontal Plane (z=c)</option>
            <option value="vPlane">Vertical Plane (x=c)</option>
            <option value="incPlane">Inclined Plane (z=ax+by+c)</option>
            <option value="genPlane">General Plane (Ax+By+Cz+D=0)</option>
            <option value="circCyl">Circular Cylinder</option>
            <option value="sphere">Sphere (Pulsing)</option>
            <option value="torus">Torus (Donut)</option>
            <option value="helix">Helix Curve</option>
        </optgroup>
        <optgroup label="2. PHYSICS: MECHANICS">
            <option value="posTime">Positionâ€“Timeâ€“Space (x,y,t)</option>
            <option value="velField">Velocity Field Surface</option>
            <option value="accel">Acceleration Field Surface</option>
            <option value="proj">Projectile Motion Surface</option>
            <option value="potE">Potential Energy Surface</option>
            <option value="kinE">Kinetic Energy Dist.</option>
            <option value="grav">Gravitational Field (Warp)</option>
            <option value="equiGrav">Equipotential (Gravity)</option>
        </optgroup>
        <optgroup label="3. PHYSICS: WAVES">
            <option value="travel">Travelling Wave [A sin(kx-wt)]</option>
            <option value="stand">Standing Wave Surface</option>
            <option value="sound">Sound Wave Intensity</option>
            <option value="ripple">Ripple Tank Wave</option>
            <option value="super">Wave Superposition</option>
        </optgroup>
        <optgroup label="4. ELECTRICITY & MAGNETISM">
            <option value="ePot">Electric Potential Surface</option>
            <option value="equiE">Equipotential (Electric)</option>
            <option value="dipole">Field around Electric Dipole</option>
            <option value="wire">Current-Carrying Wire Field</option>
            <option value="solenoid">Solenoid Magnetic Field</option>
            <option value="emWave">Electromagnetic Wave (E/B)</option>
        </optgroup>
        <optgroup label="5. THERMODYNAMICS">
            <option value="pvt">PVâ€“T Surface (Ideal Gas)</option>
            <option value="iso">Isothermal Surface</option>
            <option value="adia">Adiabatic Surface</option>
            <option value="entropy">Entropy Surface</option>
        </optgroup>
        <optgroup label="6. OPTICS & QUANTUM">
            <option value="diff">Diffraction Pattern (Sinc)</option>
            <option value="interf">Interference Fringe Surface</option>
            <option value="wavef">Wavefront Surface</option>
            <option value="psi">Wave Function Surface (Ïˆ)</option>
            <option value="psiSq">Probability Density (|Ïˆ|Â²)</option>
            <option value="well">Potential Well (Infinite)</option>
            <option value="band">Band Structure Surface</option>
        </optgroup>
        <optgroup label="7. FLUIDS">
            <option value="fPres">Pressure Distribution (Bernoulli)</option>
            <option value="stream">Streamline Surface</option>
            <option value="turb">Turbulence Intensity</option>
        </optgroup>
    </select>

    <div class="logic-view" id="formula">Logic: Loading...</div>

    <div class="controls-row">
        <div class="control-group"><label id="l1">Mag A</label><input type="range" id="v1" min="0.1" max="5" step="0.1" value="2" oninput="draw(true)"></div>
        <div class="control-group"><label id="l2">Freq B</label><input type="range" id="v2" min="0.1" max="5" step="0.1" value="1" oninput="draw(true)"></div>
        <div class="control-group"><label id="l3">Speed</label><input type="range" id="v3" min="0" max="2" step="0.1" value="0.5" oninput="draw(true)"></div>
    </div>
</div>

<script>
let isLight = false, rot = null, anim = null, t = 0, angle = 0;

function toggleCollapse() { document.getElementById('uiPanel').classList.toggle('collapsed'); }
function toggleTheme() { isLight = !isLight; document.body.classList.toggle('light-mode'); draw(); }

function toggleRotate() {
    if(rot) { clearInterval(rot); rot = null; }
    else { rot = setInterval(() => { angle += 0.02; Plotly.relayout('plot-area', { 'scene.camera.eye': { x: 1.8*Math.cos(angle), y: 1.8*Math.sin(angle), z: 1 } }); }, 30); }
}

function toggleAnimation() {
    const btn = document.getElementById("animBtn");
    if(anim) { clearInterval(anim); anim = null; btn.innerText = "â–¶ Play"; btn.classList.remove("anim-active"); }
    else { btn.innerText = "â–  Stop"; btn.classList.add("anim-active"); anim = setInterval(() => { t += 0.1; draw(true); }, 40); }
}

function updateUI() {
    const type = masterType.value;
    const f = document.getElementById("formula");
    const m = {
        hPlane: "Z = A + sin(t)", circCyl: "xÂ² + yÂ² = rÂ²", travel: "Z = A * sin(B*X - t)", 
        pvt: "P = nRT / V", psiSq: "|Ïˆ|Â² = |sin(AX)sin(BY)|Â²", grav: "Z = -A / (R + sin(t))"
    };
    f.innerText = m[type] || "Z = PhysicalLaw(X, Y, t)";
}

function draw(isUpdate = false) {
    const type = masterType.value;
    const a = parseFloat(document.getElementById('v1').value);
    const b = parseFloat(document.getElementById('v2').value);
    const s = parseFloat(document.getElementById('v3').value);
    const tv = t * s;

    if(["torus","sphere","helix","circCyl"].includes(type)) {
        let uRange = [], vRange = []; for(let i=0; i<=6.4; i+=0.4) { uRange.push(i); vRange.push(i); }
        let X=[], Y=[], Z=[];
        for(let u of uRange) {
            let xr=[], yr=[], zr=[];
            for(let v of vRange) {
                if(type==="torus"){ xr.push((a+b*Math.cos(v))*Math.cos(u+tv)); yr.push((a+b*Math.cos(v))*Math.sin(u+tv)); zr.push(b*Math.sin(v)); }
                else if(type==="sphere"){ let r=a*(1+0.1*Math.sin(tv)); xr.push(r*Math.sin(u)*Math.cos(v)); yr.push(r*Math.sin(u)*Math.sin(v)); zr.push(r*Math.cos(u)); }
                else if(type==="circCyl"){ xr.push(a*Math.cos(u)); yr.push(a*Math.sin(u)); zr.push(v-3.2+Math.sin(tv)); }
            }
            X.push(xr); Y.push(yr); Z.push(zr);
        }
        if(type==="helix"){
            let pts=[]; for(let i=0;i<12;i+=0.2) pts.push(i);
            render(pts.map(p=>a*Math.cos(p+tv)), pts.map(p=>a*Math.sin(p+tv)), pts.map(p=>b*p), isUpdate, 'scatter3d');
        } else render(X,Y,Z,isUpdate,'surface');
        return;
    }

    let x=[], y=[]; for(let i=-5; i<=5; i+=0.5) { x.push(i); y.push(i); }
    let z = y.map(Y => x.map(X => {
        let r = Math.sqrt(X*X + Y*Y) + 0.1;
        switch(type) {
            case "posTime": return a*X + b*Y + Math.sin(tv);
            case "proj": return a*X - 0.5*b*(X*X/a) + Math.cos(tv);
            case "grav": return -a/(r + 0.2*Math.sin(tv));
            case "travel": return a*Math.sin(b*X - tv);
            case "ripple": return a*Math.sin(b*r - tv)/r;
            case "stand": return a*Math.sin(b*X)*Math.cos(b*Y + tv);
            case "psiSq": return Math.pow(Math.sin(a*X)*Math.sin(b*Y), 2)*(1+0.5*Math.cos(tv));
            case "pvt": return (a*(Y+6+Math.sin(tv)))/(X+6);
            case "dipole": return (a/Math.sqrt((X-b)**2+Y**2+0.1)) - (a/Math.sqrt((X+b)**2+Y**2+0.1))*Math.cos(tv);
            case "turb": return a*Math.sin(X*b + tv) + (Math.random()*0.2);
            default: return a*Math.sin(r - tv);
        }
    }));
    render(x,y,z,isUpdate,'surface');
}

function render(x,y,z,isUpdate,mode) {
    const trace = { x:x, y:y, z:z, type:mode, colorscale:'Portland', showscale:false };
    const layout = { paper_bgcolor:"rgba(0,0,0,0)", margin:{l:0,r:0,t:0,b:0}, scene:{xaxis:{visible:false}, yaxis:{visible:false}, zaxis:{visible:false}, camera:{eye:{x:1.5,y:1.5,z:1.2}}} };
    if(isUpdate) Plotly.react("plot-area", [trace], layout); else Plotly.newPlot("plot-area", [trace], layout);
}
window.onload = () => { updateUI(); draw(); };
</script>
</body>
</html>